#include "../src/shiy/shiy.h"
#include <stdlib.h>

using namespace std;
using namespace shiy;

int main() {
  std::vector<uint8_t> k(16);
  k[0] = 0x2b, k[1] = 0x7e, k[2] = 0x15, k[3] = 0x16;
  k[4] = 0x28, k[5] = 0xae, k[6] = 0xd2, k[7] = 0xa6;
  k[8] = 0xab, k[9] = 0xf7, k[10] = 0x15, k[11] = 0x88;
  k[12] = 0x09, k[13] = 0xcf, k[14] = 0x4f, k[15] = 0x3c;
  shiy::Aes saes;

  // Key schedule
  saes.InitKey(k);

  // Generating look-up tables and storing in saes object
  // saes.InitRound();
  
  for (int i = 1; i <= 10; i += 2) {
    
    // ------------------------------------------------------------
    // warning: enable all method will cause extremely time cost!
    // ------------------------------------------------------------

    // Enable NSNL method at round i
    saes.EnableNSNL(i);

    // Enable PA method at round i with parameter 2
    // saes.EnablePartialAdder(i, 2);

  }
  saes.InitRound();

  // Print look-up tables to file
  FILE *fp = fopen("../../BlueGalaxyEnergy/src/bluegalaxyenergy/WBSLT.py", "w");
  saes.PrintTable(fp);
  
  fprintf(fp, "temp = [[0]*64 for _ in range(16)]\n"
"\n"
"def EncRound1(data):\n"
"    state = [0]*16\n"
"    for i in range(16):\n"
"        state[i] = data[i]\n"
"    for i in range(16):\n"
"        r = i % 4\n"
"        c = i // 4\n"
"        for j in range(8):\n"
"            temp[r][c*8 + j] = type_ii1[i][state[i]][j]\n"
"    for i in range(32):\n"
"        temp[1][i] = type_iv1a[0][i][temp[0][i]][temp[1][i]]\n"
"    for i in range(2, 4):\n"
"        for j in range(32):\n"
"            temp[i][j] = type_iv1a[i-1][j][temp[i-1][j]][temp[i][j]]\n"
"    for i in range(16):\n"
"        state[i] = temp[3][i*2] * offset1a + temp[3][i*2 + 1]\n"
"    for i in range(16):\n"
"        r = i % 4\n"
"        c = i // 4\n"
"        for j in range(8):\n"
"            temp[r][c*8 + j] = type_iii1[i][state[i]][j]\n"
"    for i in range(32):\n"
"        temp[1][i] = type_iv1b[0][i][temp[0][i]][temp[1][i]]\n"
"    for i in range(2, 4):\n"
"        for j in range(32):\n"
"            temp[i][j] = type_iv1b[i-1][j][temp[i-1][j]][temp[i][j]]\n"
"    for i in range(16):\n"
"        state[i] = temp[3][i*2] * offset1b + temp[3][i*2 + 1]\n"
"    return bytes(state[x] %% 256 for x in range(16))\n"
"\n"
"def EncRound2(data):\n"
"    state = [0]*16\n"
"    for i in range(16):\n"
"        state[i] = data[i]\n"
"    for i in range(16):\n"
"        r = i % 4\n"
"        c = i // 4\n"
"        for j in range(8):\n"
"            temp[r][c*8 + j] = type_ii2[i][state[i]][j]\n"
"    for i in range(32):\n"
"        temp[1][i] = type_iv2a[0][i][temp[0][i]][temp[1][i]]\n"
"    for i in range(2, 4):\n"
"        for j in range(32):\n"
"            temp[i][j] = type_iv2a[i-1][j][temp[i-1][j]][temp[i][j]]\n"
"    for i in range(16):\n"
"        state[i] = temp[3][i*2] * offset2a + temp[3][i*2 + 1]\n"
"    for i in range(16):\n"
"        r = i % 4\n"
"        c = i // 4\n"
"        for j in range(8):\n"
"            temp[r][c*8 + j] = type_iii2[i][state[i]][j]\n"
"    for i in range(32):\n"
"        temp[1][i] = type_iv2b[0][i][temp[0][i]][temp[1][i]]\n"
"    for i in range(2, 4):\n"
"        for j in range(32):\n"
"            temp[i][j] = type_iv2b[i-1][j][temp[i-1][j]][temp[i][j]]\n"
"    for i in range(16):\n"
"        state[i] = temp[3][i*2] * offset2b + temp[3][i*2 + 1]\n"
"    return bytes(state[x] %% 256 for x in range(16))\n"
"\n"
"def EncRound3(data):\n"
"    state = [0]*16\n"
"    for i in range(16):\n"
"        state[i] = data[i]\n"
"    for i in range(16):\n"
"        r = i % 4\n"
"        c = i // 4\n"
"        for j in range(8):\n"
"            temp[r][c*8 + j] = type_ii3[i][state[i]][j]\n"
"    for i in range(32):\n"
"        temp[1][i] = type_iv3a[0][i][temp[0][i]][temp[1][i]]\n"
"    for i in range(2, 4):\n"
"        for j in range(32):\n"
"            temp[i][j] = type_iv3a[i-1][j][temp[i-1][j]][temp[i][j]]\n"
"    for i in range(16):\n"
"        state[i] = temp[3][i*2] * offset3a + temp[3][i*2 + 1]\n"
"    for i in range(16):\n"
"        r = i % 4\n"
"        c = i // 4\n"
"        for j in range(8):\n"
"            temp[r][c*8 + j] = type_iii3[i][state[i]][j]\n"
"    for i in range(32):\n"
"        temp[1][i] = type_iv3b[0][i][temp[0][i]][temp[1][i]]\n"
"    for i in range(2, 4):\n"
"        for j in range(32):\n"
"            temp[i][j] = type_iv3b[i-1][j][temp[i-1][j]][temp[i][j]]\n"
"    for i in range(16):\n"
"        state[i] = temp[3][i*2] * offset3b + temp[3][i*2 + 1]\n"
"    return bytes(state[x] %% 256 for x in range(16))\n"
"\n"
"def EncRound4(data):\n"
"    state = [0]*16\n"
"    for i in range(16):\n"
"        state[i] = data[i]\n"
"    for i in range(16):\n"
"        r = i % 4\n"
"        c = i // 4\n"
"        for j in range(8):\n"
"            temp[r][c*8 + j] = type_ii4[i][state[i]][j]\n"
"    for i in range(32):\n"
"        temp[1][i] = type_iv4a[0][i][temp[0][i]][temp[1][i]]\n"
"    for i in range(2, 4):\n"
"        for j in range(32):\n"
"            temp[i][j] = type_iv4a[i-1][j][temp[i-1][j]][temp[i][j]]\n"
"    for i in range(16):\n"
"        state[i] = temp[3][i*2] * offset4a + temp[3][i*2 + 1]\n"
"    for i in range(16):\n"
"        r = i % 4\n"
"        c = i // 4\n"
"        for j in range(8):\n"
"            temp[r][c*8 + j] = type_iii4[i][state[i]][j]\n"
"    for i in range(32):\n"
"        temp[1][i] = type_iv4b[0][i][temp[0][i]][temp[1][i]]\n"
"    for i in range(2, 4):\n"
"        for j in range(32):\n"
"            temp[i][j] = type_iv4b[i-1][j][temp[i-1][j]][temp[i][j]]\n"
"    for i in range(16):\n"
"        state[i] = temp[3][i*2] * offset4b + temp[3][i*2 + 1]\n"
"    return bytes(state[x] %% 256 for x in range(16))\n"
"\n"
"def EncRound5(data):\n"
"    state = [0]*16\n"
"    for i in range(16):\n"
"        state[i] = data[i]\n"
"    for i in range(16):\n"
"        r = i % 4\n"
"        c = i // 4\n"
"        for j in range(8):\n"
"            temp[r][c*8 + j] = type_ii5[i][state[i]][j]\n"
"    for i in range(32):\n"
"        temp[1][i] = type_iv5a[0][i][temp[0][i]][temp[1][i]]\n"
"    for i in range(2, 4):\n"
"        for j in range(32):\n"
"            temp[i][j] = type_iv5a[i-1][j][temp[i-1][j]][temp[i][j]]\n"
"    for i in range(16):\n"
"        state[i] = temp[3][i*2] * offset5a + temp[3][i*2 + 1]\n"
"    for i in range(16):\n"
"        r = i % 4\n"
"        c = i // 4\n"
"        for j in range(8):\n"
"            temp[r][c*8 + j] = type_iii5[i][state[i]][j]\n"
"    for i in range(32):\n"
"        temp[1][i] = type_iv5b[0][i][temp[0][i]][temp[1][i]]\n"
"    for i in range(2, 4):\n"
"        for j in range(32):\n"
"            temp[i][j] = type_iv5b[i-1][j][temp[i-1][j]][temp[i][j]]\n"
"    for i in range(16):\n"
"        state[i] = temp[3][i*2] * offset5b + temp[3][i*2 + 1]\n"
"    return bytes(state[x] %% 256 for x in range(16))\n"
"\n"
"def EncRound6(data):\n"
"    state = [0]*16\n"
"    for i in range(16):\n"
"        state[i] = data[i]\n"
"    for i in range(16):\n"
"        r = i % 4\n"
"        c = i // 4\n"
"        for j in range(8):\n"
"            temp[r][c*8 + j] = type_ii6[i][state[i]][j]\n"
"    for i in range(32):\n"
"        temp[1][i] = type_iv6a[0][i][temp[0][i]][temp[1][i]]\n"
"    for i in range(2, 4):\n"
"        for j in range(32):\n"
"            temp[i][j] = type_iv6a[i-1][j][temp[i-1][j]][temp[i][j]]\n"
"    for i in range(16):\n"
"        state[i] = temp[3][i*2] * offset6a + temp[3][i*2 + 1]\n"
"    for i in range(16):\n"
"        r = i % 4\n"
"        c = i // 4\n"
"        for j in range(8):\n"
"            temp[r][c*8 + j] = type_iii6[i][state[i]][j]\n"
"    for i in range(32):\n"
"        temp[1][i] = type_iv6b[0][i][temp[0][i]][temp[1][i]]\n"
"    for i in range(2, 4):\n"
"        for j in range(32):\n"
"            temp[i][j] = type_iv6b[i-1][j][temp[i-1][j]][temp[i][j]]\n"
"    for i in range(16):\n"
"        state[i] = temp[3][i*2] * offset6b + temp[3][i*2 + 1]\n"
"    return bytes(state[x] %% 256 for x in range(16))\n"
"\n"
"def EncRound7(data):\n"
"    state = [0]*16\n"
"    for i in range(16):\n"
"        state[i] = data[i]\n"
"    for i in range(16):\n"
"        r = i % 4\n"
"        c = i // 4\n"
"        for j in range(8):\n"
"            temp[r][c*8 + j] = type_ii7[i][state[i]][j]\n"
"    for i in range(32):\n"
"        temp[1][i] = type_iv7a[0][i][temp[0][i]][temp[1][i]]\n"
"    for i in range(2, 4):\n"
"        for j in range(32):\n"
"            temp[i][j] = type_iv7a[i-1][j][temp[i-1][j]][temp[i][j]]\n"
"    for i in range(16):\n"
"        state[i] = temp[3][i*2] * offset7a + temp[3][i*2 + 1]\n"
"    for i in range(16):\n"
"        r = i % 4\n"
"        c = i // 4\n"
"        for j in range(8):\n"
"            temp[r][c*8 + j] = type_iii7[i][state[i]][j]\n"
"    for i in range(32):\n"
"        temp[1][i] = type_iv7b[0][i][temp[0][i]][temp[1][i]]\n"
"    for i in range(2, 4):\n"
"        for j in range(32):\n"
"            temp[i][j] = type_iv7b[i-1][j][temp[i-1][j]][temp[i][j]]\n"
"    for i in range(16):\n"
"        state[i] = temp[3][i*2] * offset7b + temp[3][i*2 + 1]\n"
"    return bytes(state[x] %% 256 for x in range(16))\n"
"\n"
"def EncRound8(data):\n"
"    state = [0]*16\n"
"    for i in range(16):\n"
"        state[i] = data[i]\n"
"    for i in range(16):\n"
"        r = i % 4\n"
"        c = i // 4\n"
"        for j in range(8):\n"
"            temp[r][c*8 + j] = type_ii8[i][state[i]][j]\n"
"    for i in range(32):\n"
"        temp[1][i] = type_iv8a[0][i][temp[0][i]][temp[1][i]]\n"
"    for i in range(2, 4):\n"
"        for j in range(32):\n"
"            temp[i][j] = type_iv8a[i-1][j][temp[i-1][j]][temp[i][j]]\n"
"    for i in range(16):\n"
"        state[i] = temp[3][i*2] * offset8a + temp[3][i*2 + 1]\n"
"    for i in range(16):\n"
"        r = i % 4\n"
"        c = i // 4\n"
"        for j in range(8):\n"
"            temp[r][c*8 + j] = type_iii8[i][state[i]][j]\n"
"    for i in range(32):\n"
"        temp[1][i] = type_iv8b[0][i][temp[0][i]][temp[1][i]]\n"
"    for i in range(2, 4):\n"
"        for j in range(32):\n"
"            temp[i][j] = type_iv8b[i-1][j][temp[i-1][j]][temp[i][j]]\n"
"    for i in range(16):\n"
"        state[i] = temp[3][i*2] * offset8b + temp[3][i*2 + 1]\n"
"    return bytes(state[x] %% 256 for x in range(16))\n"
"\n"
"def EncRound9(data):\n"
"    state = [0]*16\n"
"    for i in range(16):\n"
"        state[i] = data[i]\n"
"    for i in range(16):\n"
"        r = i % 4\n"
"        c = i // 4\n"
"        for j in range(8):\n"
"            temp[r][c*8 + j] = type_ii9[i][state[i]][j]\n"
"    for i in range(32):\n"
"        temp[1][i] = type_iv9a[0][i][temp[0][i]][temp[1][i]]\n"
"    for i in range(2, 4):\n"
"        for j in range(32):\n"
"            temp[i][j] = type_iv9a[i-1][j][temp[i-1][j]][temp[i][j]]\n"
"    for i in range(16):\n"
"        state[i] = temp[3][i*2] * offset9a + temp[3][i*2 + 1]\n"
"    for i in range(16):\n"
"        r = i % 4\n"
"        c = i // 4\n"
"        for j in range(8):\n"
"            temp[r][c*8 + j] = type_iii9[i][state[i]][j]\n"
"    for i in range(32):\n"
"        temp[1][i] = type_iv9b[0][i][temp[0][i]][temp[1][i]]\n"
"    for i in range(2, 4):\n"
"        for j in range(32):\n"
"            temp[i][j] = type_iv9b[i-1][j][temp[i-1][j]][temp[i][j]]\n"
"    for i in range(16):\n"
"        state[i] = temp[3][i*2] * offset9b + temp[3][i*2 + 1]\n"
"    return bytes(state[x] %% 256 for x in range(16))\n"
"\n"
"def EncRound10(data):\n"
"    state = [0]*16\n"
"    for i in range(16):\n"
"        state[i] = data[i]\n"
"    # print(state)\n"
"    for i in range(16):\n"
"        for j in range(32):\n"
"            temp[i][j] = type_i10[i][state[i]][j]\n"
"    for i in range(32):\n"
"        temp[1][i] = type_iv10[0][i][temp[0][i]][temp[1][i]]\n"
"    for i in range(2, 16):\n"
"        for j in range(32):\n"
"            temp[i][j] = type_iv10[i-1][j][temp[i-1][j]][temp[i][j]]\n"
"    for i in range(16):\n"
"        state[i] = temp[15][i*2] * offset10 + temp[15][i*2 + 1]\n"
"    return bytes(state[x] %% 256 for x in range(16))\n"
"\n"
"from .WhiteBoxedAES import WhiteBoxedAES\n"
"import time\n"
"\n"
"class WBSLT(WhiteBoxedAES):\n"
"\n"
"    def __init__(self, aesEncoded, isEncrypt=True):\n"
"        self.aesEncoded = aesEncoded\n"
"        self.encrypt = isEncrypt\n"
"\n"
"    def isEncrypt(self):\n"
"        return self.encrypt\n"
"\n"
"    def getRoundNumber(self):\n"
"        return self.aesEncoded.r\n"
"\n"
"    def applyRound(self, data, roundN):\n"
"        if self.encrypt:\n"
"            if roundN == 1:\n"
"                return EncRound1(data)\n"
"            elif roundN == 2:\n"
"                return EncRound2(data)\n"
"            elif roundN == 3:\n"
"                return EncRound3(data)\n"
"            elif roundN == 4:\n"
"                return EncRound4(data)\n"
"            elif roundN == 5:\n"
"                return EncRound5(data)\n"
"            elif roundN == 6:\n"
"                return EncRound6(data)\n"
"            elif roundN == 7:\n"
"                return EncRound7(data)\n"
"            elif roundN == 8:\n"
"                return EncRound8(data)\n"
"            elif roundN == 9:\n"
"                return EncRound9(data)\n"
"            else:\n"
"                return EncRound10(data)\n"
"\n"
"        else:\n"
"            return self.aesEncoded.decrypt_round_encode(data, self.getRoundNumber() - (roundN + 1))\n");
  fclose(fp);

  return 0;
}
